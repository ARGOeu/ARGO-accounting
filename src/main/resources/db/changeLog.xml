<?xml version="1.0"  encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
        xmlns:pro="http://www.liquibase.org/xml/ns/pro"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
	http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.0.xsd
	http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd
    http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.0.xsd">

    <changeSet id="1" author="accounting-system">
        <ext:createCollection collectionName="MetricDefinition">
            <ext:options>
                {
                validator: {
                $jsonSchema: {
                bsonType: "object",
                required: ["metricName", "unitType", "metricType"],
                properties: {
                metricName: {
                bsonType: "string",
                description: "The name of the Metric"
                },
                metricType: {
                bsonType: "string",
                description: "Metric Type of the Metric"
                },
                metricDescription: {
                bsonType: "string",
                description: "Description of how the metric is collected"
                },
                unitType: {
                bsonType: "string",
                description: "Unit Type of the Virtual Access Metric"
                }
                }
                }
                },
                validationAction: "warn",
                validationLevel: "strict"
                }
            </ext:options>
        </ext:createCollection>
    </changeSet>

    <changeSet id="2" author="accounting-system">
        <ext:createIndex collectionName="MetricDefinition">
            <ext:keys>
                { metricName: 1, unitType: 1}
            </ext:keys>
            <ext:options>
                {unique: true, name: "unique_name_unit_type"}
            </ext:options>
        </ext:createIndex>
    </changeSet>

    <changeSet id="3" author="accounting-system">
        <ext:createCollection collectionName="Metric">
            <ext:options>
                {
                validator: {
                $jsonSchema: {
                bsonType: "object",
                required: ["metricDefinitionId", "resourceId", "value", "start", "end"],
                properties: {
                metricDefinitionId: {
                bsonType: "string",
                description: "The Metric Definition to be assigned"
                },
                resourceId: {
                bsonType: "string",
                description: "Unique Identifier from the resource"
                },
                value: {
                bsonType: "double",
                description: "Value of the metric for the given period"
                },
                start: {
                bsonType: "date",
                description: "Timestamp of the starting date time (Zulu timestamp)"
                },
                end: {
                bsonType: "date",
                description: "Timestamp of the end date time (Zulu timestamp)"
                }
                }
                }
                },
                validationAction: "warn",
                validationLevel: "strict"
                }
            </ext:options>
        </ext:createCollection>
    </changeSet>
</databaseChangeLog>